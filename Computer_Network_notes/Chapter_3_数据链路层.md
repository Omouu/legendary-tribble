# 计算机网络-Ch3-数据链路层

---
##目录
[TOC]

> 刚开始，你可能认为这个问题非常简单，似乎没有什么内容需要学习——机器A把比特放到线路上，然后机器B将这些比特取下来。不幸的是，通信线路偶尔会出错。而且，它们只有有限的数据传输率，并且在比特的发送时间和接受时间之间存在一个非零延迟。这些限制对数据传输的效率有非常重要的影响。通信所采用的协议必须考虑所有的这些因素。这些协议正是本章的主题。

## 1 数据链路层的设计问题

- 数据链路层的**功能**：
 - 向网络层提供一个定义良好的服务接口
 - 处理传输错误
 - 调节数据流，确保慢速的接收方不会被快速的发送方淹没
- 数据链路层的**服务**：
 - **无确认的无连接服务**：原机器向目标机器发送独立的帧，目标机器并不对这些帧进行确认，适合*错误率低的场合*（差错恢复留给上层），*实时通信*（数据迟到比数据受损更糟）。（以太网）
 - **有确认的无连接服务**：无逻辑连接，但发送的每一帧都要单独确认，适用于*不可靠信道*。（802.11 - WiFi)
 - **有确认的有连接服务**：参考电话网络的电路交换，每帧还许确认。适用于*长距离且不可靠的链路*。（卫星信道，长途电话电路）

> 当时用**面向连接的服务**时，数据传输必须经过**三**个不同的阶段。在一个阶段，要**建立连接**，双方初始化各种变量和计数器，这些变量和计数器记录了哪些帧已经接收到，哪些帧还没有收到。在第二个阶段，才真正**传输一个或者多个数据帧**。在第三个也是最后一个阶段中，**连接被释放**，所有的变量、缓冲区以及其他用于维护该连接的资源也随之被释放。

### 1.1 成帧 
将来自物理层的比特流拆分为离散的帧，并附加帧头和帧尾。接收方可根据帧头和帧尾判断数据是否完整正确，进而否是请求重传。

- 拆分比特流的方法：
 - **字节计数法**：
 **5** 1 2 3 4 **5** 6 7 8 9 **8** 0 1 2 3 4 5 6 **8** 7 8 9 0 1 2 3
 帧1有5个字节……帧3有8个字节……，容易因为一个传输错误而被弄混。

 - **字节填充的标志字节法**：
 **首尾**插入**标志字节**： |**FLAG**|HEAD| 有效载荷 |TAIL|**FLAG**|
 在数据中的FLAG前插入**转义字符ESC**（出现的ESC前也插入ESC）：
|A|ESC|FLAG|B| → |A|**ESC**|ESC|**ESC**|FLAG|B|

 - **比特填充的标志比特法**：（USB）
  FLAG = 0x7E = 01111110
  数据中遇到连续的5个1时添加一个0在之后：
  原数据：0 1 1 0 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1  0 0 1 0 
  物理层中的比特流： 0 1 1 0 1 1 1 1 1 **0** 1 1 1 1 1 **0** 1 1 1 1 1 **0** 0 0 1 0

 - **物理层编码违禁法**：（4B/5B，802.11，以太网）

### 1.2 差错控制
反馈帧，应对帧丢失的计时器设置，应对帧重复的帧序号设置
### 1.3 流量控制
应对**高速**的**发送方**和**低速**的**接收方**。

 - **基于反馈的流量控制**：反馈接收方的状态（重点；可出现在数据链路层及以上）
 - **基于速率的流量控制**：限制发送方的速率（尽在传输层可见；近来较常见，因为链路层速度足够快）
 
## 2 差错检测和纠正
> 在**高度可靠的信道**上（比如**光纤**），较为合算的做法是使用**检错码**，当偶尔发生错误时只需要重传整个数据块。在**错误**发生很**频繁**的信道上（比如**无线链路**），更好的做法是在每一个数据块中加入足够的**冗余信息**，以便接收方能够计算出原始的数据块。
### 2.1 纠错码 - error-correcting code
- **系统码** - systematic code ：直接发送**数据位**，再发送**校验位**。
- **线性码** - line code ：**校验位**是被某线性函数用**数据位**作为变量而计算出的结果。

#### 2.1.1 汉明码（Hamming code）
只能容许1bit错误。编码规则：正确的信息码之间最少要有2bits的差别。

- **校验码的位置**：
  将总数据从左向右编号，从1开始，**2的幂次方**位为**校验位**，如1，2，4，8，16等，其他位为**信息位**。
- **校验码的值**：
  校验码的值为对应有效信息位**组**的**XOR和(奇偶校验)**。设校验码的编号为**i**，则从该校验位开始向右，每i个信息位归为一组。

***例：编号为2的校验位对应的组别(信息位为11001010)*** ：0 **0 1** 0 1 **0 0** 0 1 **0 1** 0

- **纠错**：若有错，重新计算接受到的数据的校验位并于原校验位XOR，将结果作为综合集计算得到的整数既出错的bit。比如**1位**为‘0’，**2位**为‘1’，**4位**为‘0’，**8位**为‘1’，综合结果即$1*8+0*4+1*2+0*1=10$.
 
#### 2.1.2 二进制卷积码（convolutional code)（略）
#### 2.1.3 里德所罗门码（略）
#### 2.1.4 低密度奇偶校验码（略）

### 2.2 检错码 - error-detecting code









##ABBREVIATION

**NIC** - Network Interface Cards - 网络接口卡
**FEC** - Forward Error Correction - 前向纠错
